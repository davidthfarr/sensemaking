<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dynamic Narrative Cartography — Venezuela</title>
  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0b0f14; color:#e7edf5; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 28px 18px 60px; }
    h1 { font-size: 28px; margin: 0 0 10px; }
    h2 { font-size: 18px; margin: 26px 0 8px; }
    p, li { line-height: 1.5; color:#c9d4e3; }
    .card { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.10); border-radius: 14px; padding: 16px; margin: 14px 0; }
    .btnrow { display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    a.btn { display:inline-block; text-decoration:none; color:#0b0f14; background:#9bd3ff; padding:10px 14px; border-radius: 10px; font-weight: 650; }
    a.btn.secondary { background: rgba(155,211,255,0.18); color:#e7edf5; border:1px solid rgba(155,211,255,0.35); }
    code { background: rgba(255,255,255,0.06); padding: 2px 6px; border-radius: 6px; }
    .grid { display:grid; grid-template-columns: 1fr; gap: 10px; }
    @media (min-width: 900px) { .grid { grid-template-columns: 1fr 1fr; } }
    .small { font-size: 13px; color:#9fb0c6; }
    .hr { height:1px; background: rgba(255,255,255,0.10); margin: 18px 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Dynamic Narrative Cartography — Venezuela Dataset</h1>
    <p class="small">Offline, single-file dashboards. Open this page first, then launch the dashboard.</p>

    <div class="card">
      <h2>What this is</h2>
      <p>
        This dashboard visualizes how narrative clusters drift over time in a shared semantic space.
        Each time window is clustered (HDBSCAN) on post embeddings; cluster centroids are projected into 2D (PCA),
        and we link centroids across adjacent windows by similarity to show lineage.
      </p>
      <div class="btnrow">
        <a class="btn" href="./ven_narrative_drift_click.html">Open dashboard</a>
        <a class="btn secondary" href="#how-to-use">How to use</a>
        <a class="btn secondary" href="#pipeline">Pipeline overview</a>
      </div>
    </div>

    <div class="grid">
      <div class="card" id="how-to-use">
        <h2>How to use the dashboard</h2>
        <ul>
          <li>Use ◀ ▶ to step through time windows (hourly rolling windows).</li>
          <li>Click a cluster marker to reveal sampled posts (overlay) in the same space.</li>
          <li>The right-side panel shows an LLM-generated one-paragraph summary for that (window, cluster).</li>
          <li>Hover on clusters for representative examples and metadata.</li>
        </ul>
        <p class="small">
          Tip: if a cluster has “No summary found,” the summary keys probably don’t match the evaluated window string exactly.
        </p>
      </div>

      <div class="card">
        <h2>Key artifacts (where things live)</h2>
        <ul>
          <li><code>data/processed/venezuela/posts_repr.parquet</code> — canonical representation (post_id, timestamp, text, embedding)</li>
          <li><code>data/evaluated/ven/hourly/*.parquet</code> — window-level cluster assignments</li>
          <li><code>data/evaluated/ven/cluster_summaries.parquet</code> — one-paragraph LLM summaries per cluster</li>
          <li><code>ven_narrative_drift_click.html</code> — interactive dashboard</li>
        </ul>
      </div>
    </div>

    <div class="card" id="pipeline">
      <h2>Pipeline overview (what we did)</h2>
      <ol>
        <li><b>Ingest + clean CSV</b>: normalize fields (post_id, timestamp, text, author_id, etc.).</li>
        <li><b>Canonical representation</b>: write <code>posts_repr.parquet</code> including embeddings.</li>
        <li><b>Rolling windows</b>: generate hourly windows (e.g., 12-hour window, 4-hour step) and cluster each window.</li>
        <li><b>Cluster summaries</b>: sample posts per (window, cluster) and call OpenAI to generate 1-paragraph summaries.</li>
        <li><b>Dashboard build</b>: compute centroid lineage across windows + PCA projection + inject tweet payload + summaries + navigation.</li>
      </ol>
      <div class="hr"></div>
      <p class="small">
        Implementation note: the dashboard is a single HTML file with embedded data payloads (tweet samples + summary text), so it works offline.
      </p>
    </div>

    <div class="card">
      <h2>Known gotchas</h2>
      <ul>
        <li>Hourly windows must include the hour in the window label (use <code>%H</code>, not <code>%h</code>).</li>
        <li>If timestamps were saved to CSV, reload with <code>pd.to_datetime(..., utc=True)</code> to avoid strings/NaT.</li>
        <li>Autoplay can occur when frames exist unless <code>auto_play=False</code> is set when writing HTML.</li>
      </ul>
    </div>
  </div>
</body>
</html>
